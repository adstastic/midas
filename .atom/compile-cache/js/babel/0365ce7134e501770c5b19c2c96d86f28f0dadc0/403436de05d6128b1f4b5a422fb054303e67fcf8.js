var jQ, href, ipc;

if (window['browser-plus'] == null) {
  ipc = require('ipc');
  href = location.href;
  if (href.includes('data:text/html,')) {
    href = null;
  }
  ipc.sendToHost('startup', {
    href: href,
    title: document.title
  });
  jQ = jQuery.noConflict();
  jQ(function () {
    var jQselector, bp, style;
    CSSUtilities.define('async', false);
    CSSUtilities.init();
    if (jQ('body').find('#bp-selector').length !== 0) {
      return;
    }
    bp = window['browser-plus'] || (window['browser-plus'] = {});
    bp.selector = jQ('<div id="bp-selector">\n    <div id="bp-selector-top"></div>\n    <div id="bp-selector-left"></div>\n    <div id="bp-selector-right"></div>\n    <div id="bp-selector-bottom"></div>\n</div>');
    style = '<style type=\'text/css\'>\n  #bp-selector-top, #bp-selector-bottom {\n\tbackground: blue;\n\theight:3px;\n\tposition: fixed;o\n\ttransition:all 300ms ease;\n  z-index:9999;\n}\n#bp-selector-left, #bp-selector-right {\n\tbackground: blue;\n\twidth:3px;\n\tposition: fixed;\n\ttransition:all 300ms ease;\n  z-index:9999;\n}\n\n.n{\n -webkit-transform: scale(3) translateX(100px)\n}\n</style>';
    jQ('head').append(style);
    jQselector = jQ('body').append(bp.selector);
    bp.selector.hide();
    bp.clicked = false;
    bp.elements = {
      top: jQselector.find('#bp-selector-top'),
      left: jQselector.find('#bp-selector-left'),
      right: jQselector.find('#bp-selector-right'),
      bottom: jQselector.find('#bp-selector-bottom')
    };
    bp.click = function (evt) {
      var count, css, target, traverse;
      bp = window['browser-plus'];
      if (bp.clicked) {
        jQ(document).on('mousemove', bp.mouseMove);
      } else {
        jQ(document).off('mousemove', bp.mouseMove);
        count = 100;
        css = {};
        target = jQ(bp.target[0].outerHTML);
        css['bp-' + count] = CSSUtilities.getCSSProperties(bp.target[0], 'screen');
        target[0].className += ' bp-' + count;
        traverse = function (root) {
          var ele, orgEle, _i, _len, _ref, _results;
          _ref = root.children();
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            ele = _ref[_i];
            orgEle = jQ(bp.target[0]).find(ele.nodeName).filter(function () {
              return this.outerHTML === ele.outerHTML;
            });
            count += 1;
            ele.className = ele.className + (' bp-' + count);
            css['bp-' + count] = CSSUtilities.getCSSProperties(orgEle[0], 'screen');
            _results.push(traverse(jQ(ele)));
          }
          return _results;
        };
        traverse(target);
        this.html = target[0].outerHTML;
        this.css = css;
        ipc.sendToHost('selection', {
          css: this.css,
          html: this.html
        });
      }
      bp.clicked = !bp.clicked;
      return false;
    };
    bp.mouseMove = function (evt) {
      var jQtarget, elements, targetHeight, targetOffset, targetWidth;
      if (evt.target.id.indexOf('bp-selector') !== -1 || evt.target.tagName === 'BODY' || evt.target.tagName === 'HTML') {
        return;
      }
      bp = window['browser-plus'];
      bp.target = jQtarget = jQ(evt.target);
      targetOffset = jQtarget[0].getBoundingClientRect();
      targetHeight = targetOffset.height;
      targetWidth = targetOffset.width;
      elements = bp.elements;
      elements.top.css({
        left: targetOffset.left - 4,
        top: targetOffset.top - 4,
        width: targetWidth + 5
      });
      elements.bottom.css({
        top: targetOffset.top + targetHeight + 1,
        left: targetOffset.left - 3,
        width: targetWidth + 4
      });
      elements.left.css({
        left: targetOffset.left - 5,
        top: targetOffset.top - 4,
        height: targetHeight + 8
      });
      return elements.right.css({
        left: targetOffset.left + targetWidth + 1,
        top: targetOffset.top - 4,
        height: targetHeight + 8
      });
    };
    ipc.on('select', function () {
      bp = window['browser-plus'];
      bp.selector.show();
      jQ(document).mousemove(bp.mouseMove);
      return jQ(document).click(bp.click);
    });
    ipc.on('deselect', function () {
      bp = window['browser-plus'];
      bp.selector.hide();
      jQ(document).off('mousemove', bp.mouseMove);
      return jQ(document).off('click', bp.click);
    });
    ipc.on('selection', function () {
      var css, div, doc, html, rn, selection, styl, traverse;
      html = null;
      css = [];
      selection = window.getSelection();
      if (selection.rangeCount > 0) {
        rn = selection.getRangeAt(0);
        if (!rn) {
          return ipc.sendToHost('preview', {
            url: location.href
          });
        }
        div = document.createElement('div');
        div.appendChild(rn.cloneContents());
        doc = jQ(rn.commonAncestorContainer);
        styl = document.defaultView.getComputedStyle;
        css.push(styl(doc, null));
        traverse = function (div) {
          var docEle, ele, key, val, _i, _len, _ref, _ref1, _results;
          _ref = div.children;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            ele = _ref[_i];
            docEle = doc.find(ele.nodeName).filter(function () {
              return this.outerHTML === ele.outerHTML;
            });
            if (docEle.length) {
              _ref1 = styl(docEle[0], null);
              for (key in _ref1) {
                val = _ref1[key];
                ele.style[key] = val;
              }
            }
            _results.push(traverse(ele));
          }
          return _results;
        };
        traverse(div);
      }
      return ipc.sendToHost('selection', {
        css: css,
        html: div.innerHTML
      });
    });
    return ipc.on('unclick', function () {
      jQ('a').css({
        'cursor': 'text'
      });
      return jQ('a').click(function () {
        return false;
      });
    });
  });
  ipc.on('updHist', function (hist) {
    window.histTag.opts.hist = hist;
    return window.histTag.update();
  });
  ipc.on('updFav', function (fav) {
    window.favTag.opts.fav = fav;
    return window.favTag.update();
  });
  ipc.on('historyPage', function (hist, fav) {
    window.favTag = riot.mount('fav', {
      fav: fav
    })[0];
    return window.histTag = riot.mount('hist', {
      hist: hist
    })[0];
  });
  ipc.on('clearHist', function () {
    window.histTag.unmount(false);
    return window.histTag = riot.mount('hist', []);
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9jYXRoL2hvbWVzMi96Y2FwYW11Ly5hdG9tL3BhY2thZ2VzL2Jyb3dzZXItcGx1cy9yZXNvdXJjZXMvYnJvd3Nlci1wbHVzLWNsaWVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDOztBQUVsQixJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxJQUFJLEVBQUU7QUFDbEMsS0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNyQixNQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztBQUNyQixNQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsRUFBRTtBQUNwQyxRQUFJLEdBQUcsSUFBSSxDQUFDO0dBQ2I7QUFDRCxLQUFHLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRTtBQUN4QixRQUFJLEVBQUUsSUFBSTtBQUNWLFNBQUssRUFBRSxRQUFRLENBQUMsS0FBSztHQUN0QixDQUFDLENBQUM7QUFDSCxJQUFFLEdBQUcsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQ3pCLElBQUUsQ0FBQyxZQUFXO0FBQ1osUUFBSSxVQUFVLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQztBQUMxQixnQkFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDcEMsZ0JBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNwQixRQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtBQUNoRCxhQUFPO0tBQ1I7QUFDRCxNQUFFLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxLQUFLLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxFQUFFLENBQUEsQ0FBRTtBQUM3RCxNQUFFLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyw4TEFBd00sQ0FBQyxDQUFDO0FBQzNOLFNB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RUFBRSxVQUFTLElBQUksRUFBRSxHQUFHLEVBQUU7QUFDeEMsVUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRTtBQUNoQyxTQUFHLEVBQUUsR0FBRztLQUNULENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNOLFdBQU8sTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtBQUN6QyxVQUFJLEVBQUUsSUFBSTtLQUNYLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztHQUNQLENBQUMsQ0FBQztBQUNILEtBQUcsQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLFlBQVc7QUFDN0IsVUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDOUIsV0FBTyxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0dBQ2hELENBQUMsQ0FBQztDQUNKIiwiZmlsZSI6Ii9jYXRoL2hvbWVzMi96Y2FwYW11Ly5hdG9tL3BhY2thZ2VzL2Jyb3dzZXItcGx1cy9yZXNvdXJjZXMvYnJvd3Nlci1wbHVzLWNsaWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBqUSwgaHJlZiwgaXBjO1xuXG5pZiAod2luZG93Wydicm93c2VyLXBsdXMnXSA9PSBudWxsKSB7XG4gIGlwYyA9IHJlcXVpcmUoJ2lwYycpO1xuICBocmVmID0gbG9jYXRpb24uaHJlZjtcbiAgaWYgKGhyZWYuaW5jbHVkZXMoJ2RhdGE6dGV4dC9odG1sLCcpKSB7XG4gICAgaHJlZiA9IG51bGw7XG4gIH1cbiAgaXBjLnNlbmRUb0hvc3QoJ3N0YXJ0dXAnLCB7XG4gICAgaHJlZjogaHJlZixcbiAgICB0aXRsZTogZG9jdW1lbnQudGl0bGVcbiAgfSk7XG4gIGpRID0galF1ZXJ5Lm5vQ29uZmxpY3QoKTtcbiAgalEoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGpRc2VsZWN0b3IsIGJwLCBzdHlsZTtcbiAgICBDU1NVdGlsaXRpZXMuZGVmaW5lKCdhc3luYycsIGZhbHNlKTtcbiAgICBDU1NVdGlsaXRpZXMuaW5pdCgpO1xuICAgIGlmIChqUSgnYm9keScpLmZpbmQoJyNicC1zZWxlY3RvcicpLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBicCA9IHdpbmRvd1snYnJvd3Nlci1wbHVzJ10gfHwgKHdpbmRvd1snYnJvd3Nlci1wbHVzJ10gPSB7fSk7XG4gICAgYnAuc2VsZWN0b3IgPSBqUShcIjxkaXYgaWQ9XFxcImJwLXNlbGVjdG9yXFxcIj5cXG4gICAgPGRpdiBpZD1cXFwiYnAtc2VsZWN0b3ItdG9wXFxcIj48L2Rpdj5cXG4gICAgPGRpdiBpZD1cXFwiYnAtc2VsZWN0b3ItbGVmdFxcXCI+PC9kaXY+XFxuICAgIDxkaXYgaWQ9XFxcImJwLXNlbGVjdG9yLXJpZ2h0XFxcIj48L2Rpdj5cXG4gICAgPGRpdiBpZD1cXFwiYnAtc2VsZWN0b3ItYm90dG9tXFxcIj48L2Rpdj5cXG48L2Rpdj5cIik7XG4gICAgc3R5bGUgPSBcIjxzdHlsZSB0eXBlPSd0ZXh0L2Nzcyc+XFxuICAjYnAtc2VsZWN0b3ItdG9wLCAjYnAtc2VsZWN0b3ItYm90dG9tIHtcXG5cdGJhY2tncm91bmQ6IGJsdWU7XFxuXHRoZWlnaHQ6M3B4O1xcblx0cG9zaXRpb246IGZpeGVkO29cXG5cdHRyYW5zaXRpb246YWxsIDMwMG1zIGVhc2U7XFxuICB6LWluZGV4Ojk5OTk7XFxufVxcbiNicC1zZWxlY3Rvci1sZWZ0LCAjYnAtc2VsZWN0b3ItcmlnaHQge1xcblx0YmFja2dyb3VuZDogYmx1ZTtcXG5cdHdpZHRoOjNweDtcXG5cdHBvc2l0aW9uOiBmaXhlZDtcXG5cdHRyYW5zaXRpb246YWxsIDMwMG1zIGVhc2U7XFxuICB6LWluZGV4Ojk5OTk7XFxufVxcblxcbi5ue1xcbiAtd2Via2l0LXRyYW5zZm9ybTogc2NhbGUoMykgdHJhbnNsYXRlWCgxMDBweClcXG59XFxuPC9zdHlsZT5cIjtcbiAgICBqUSgnaGVhZCcpLmFwcGVuZChzdHlsZSk7XG4gICAgalFzZWxlY3RvciA9IGpRKCdib2R5JykuYXBwZW5kKGJwLnNlbGVjdG9yKTtcbiAgICBicC5zZWxlY3Rvci5oaWRlKCk7XG4gICAgYnAuY2xpY2tlZCA9IGZhbHNlO1xuICAgIGJwLmVsZW1lbnRzID0ge1xuICAgICAgdG9wOiBqUXNlbGVjdG9yLmZpbmQoJyNicC1zZWxlY3Rvci10b3AnKSxcbiAgICAgIGxlZnQ6IGpRc2VsZWN0b3IuZmluZCgnI2JwLXNlbGVjdG9yLWxlZnQnKSxcbiAgICAgIHJpZ2h0OiBqUXNlbGVjdG9yLmZpbmQoJyNicC1zZWxlY3Rvci1yaWdodCcpLFxuICAgICAgYm90dG9tOiBqUXNlbGVjdG9yLmZpbmQoJyNicC1zZWxlY3Rvci1ib3R0b20nKVxuICAgIH07XG4gICAgYnAuY2xpY2sgPSBmdW5jdGlvbihldnQpIHtcbiAgICAgIHZhciBjb3VudCwgY3NzLCB0YXJnZXQsIHRyYXZlcnNlO1xuICAgICAgYnAgPSB3aW5kb3dbJ2Jyb3dzZXItcGx1cyddO1xuICAgICAgaWYgKGJwLmNsaWNrZWQpIHtcbiAgICAgICAgalEoZG9jdW1lbnQpLm9uKCdtb3VzZW1vdmUnLCBicC5tb3VzZU1vdmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgalEoZG9jdW1lbnQpLm9mZignbW91c2Vtb3ZlJywgYnAubW91c2VNb3ZlKTtcbiAgICAgICAgY291bnQgPSAxMDA7XG4gICAgICAgIGNzcyA9IHt9O1xuICAgICAgICB0YXJnZXQgPSBqUShicC50YXJnZXRbMF0ub3V0ZXJIVE1MKTtcbiAgICAgICAgY3NzW1wiYnAtXCIgKyBjb3VudF0gPSBDU1NVdGlsaXRpZXMuZ2V0Q1NTUHJvcGVydGllcyhicC50YXJnZXRbMF0sIFwic2NyZWVuXCIpO1xuICAgICAgICB0YXJnZXRbMF0uY2xhc3NOYW1lICs9IFwiIGJwLVwiICsgY291bnQ7XG4gICAgICAgIHRyYXZlcnNlID0gZnVuY3Rpb24ocm9vdCkge1xuICAgICAgICAgIHZhciBlbGUsIG9yZ0VsZSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgICAgIF9yZWYgPSByb290LmNoaWxkcmVuKCk7XG4gICAgICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgIGVsZSA9IF9yZWZbX2ldO1xuICAgICAgICAgICAgb3JnRWxlID0galEoYnAudGFyZ2V0WzBdKS5maW5kKGVsZS5ub2RlTmFtZSkuZmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vdXRlckhUTUwgPT09IGVsZS5vdXRlckhUTUw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvdW50ICs9IDE7XG4gICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gZWxlLmNsYXNzTmFtZSArIChcIiBicC1cIiArIGNvdW50KTtcbiAgICAgICAgICAgIGNzc1tcImJwLVwiICsgY291bnRdID0gQ1NTVXRpbGl0aWVzLmdldENTU1Byb3BlcnRpZXMob3JnRWxlWzBdLCBcInNjcmVlblwiKTtcbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godHJhdmVyc2UoalEoZWxlKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgICAgIH07XG4gICAgICAgIHRyYXZlcnNlKHRhcmdldCk7XG4gICAgICAgIHRoaXMuaHRtbCA9IHRhcmdldFswXS5vdXRlckhUTUw7XG4gICAgICAgIHRoaXMuY3NzID0gY3NzO1xuICAgICAgICBpcGMuc2VuZFRvSG9zdCgnc2VsZWN0aW9uJywge1xuICAgICAgICAgIGNzczogdGhpcy5jc3MsXG4gICAgICAgICAgaHRtbDogdGhpcy5odG1sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYnAuY2xpY2tlZCA9ICFicC5jbGlja2VkO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgYnAubW91c2VNb3ZlID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICB2YXIgalF0YXJnZXQsIGVsZW1lbnRzLCB0YXJnZXRIZWlnaHQsIHRhcmdldE9mZnNldCwgdGFyZ2V0V2lkdGg7XG4gICAgICBpZiAoZXZ0LnRhcmdldC5pZC5pbmRleE9mKFwiYnAtc2VsZWN0b3JcIikgIT09IC0xIHx8IGV2dC50YXJnZXQudGFnTmFtZSA9PT0gXCJCT0RZXCIgfHwgZXZ0LnRhcmdldC50YWdOYW1lID09PSBcIkhUTUxcIikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBicCA9IHdpbmRvd1snYnJvd3Nlci1wbHVzJ107XG4gICAgICBicC50YXJnZXQgPSBqUXRhcmdldCA9IGpRKGV2dC50YXJnZXQpO1xuICAgICAgdGFyZ2V0T2Zmc2V0ID0galF0YXJnZXRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICB0YXJnZXRIZWlnaHQgPSB0YXJnZXRPZmZzZXQuaGVpZ2h0O1xuICAgICAgdGFyZ2V0V2lkdGggPSB0YXJnZXRPZmZzZXQud2lkdGg7XG4gICAgICBlbGVtZW50cyA9IGJwLmVsZW1lbnRzO1xuICAgICAgZWxlbWVudHMudG9wLmNzcyh7XG4gICAgICAgIGxlZnQ6IHRhcmdldE9mZnNldC5sZWZ0IC0gNCxcbiAgICAgICAgdG9wOiB0YXJnZXRPZmZzZXQudG9wIC0gNCxcbiAgICAgICAgd2lkdGg6IHRhcmdldFdpZHRoICsgNVxuICAgICAgfSk7XG4gICAgICBlbGVtZW50cy5ib3R0b20uY3NzKHtcbiAgICAgICAgdG9wOiB0YXJnZXRPZmZzZXQudG9wICsgdGFyZ2V0SGVpZ2h0ICsgMSxcbiAgICAgICAgbGVmdDogdGFyZ2V0T2Zmc2V0LmxlZnQgLSAzLFxuICAgICAgICB3aWR0aDogdGFyZ2V0V2lkdGggKyA0XG4gICAgICB9KTtcbiAgICAgIGVsZW1lbnRzLmxlZnQuY3NzKHtcbiAgICAgICAgbGVmdDogdGFyZ2V0T2Zmc2V0LmxlZnQgLSA1LFxuICAgICAgICB0b3A6IHRhcmdldE9mZnNldC50b3AgLSA0LFxuICAgICAgICBoZWlnaHQ6IHRhcmdldEhlaWdodCArIDhcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGVsZW1lbnRzLnJpZ2h0LmNzcyh7XG4gICAgICAgIGxlZnQ6IHRhcmdldE9mZnNldC5sZWZ0ICsgdGFyZ2V0V2lkdGggKyAxLFxuICAgICAgICB0b3A6IHRhcmdldE9mZnNldC50b3AgLSA0LFxuICAgICAgICBoZWlnaHQ6IHRhcmdldEhlaWdodCArIDhcbiAgICAgIH0pO1xuICAgIH07XG4gICAgaXBjLm9uKCdzZWxlY3QnLCBmdW5jdGlvbigpIHtcbiAgICAgIGJwID0gd2luZG93Wydicm93c2VyLXBsdXMnXTtcbiAgICAgIGJwLnNlbGVjdG9yLnNob3coKTtcbiAgICAgIGpRKGRvY3VtZW50KS5tb3VzZW1vdmUoYnAubW91c2VNb3ZlKTtcbiAgICAgIHJldHVybiBqUShkb2N1bWVudCkuY2xpY2soYnAuY2xpY2spO1xuICAgIH0pO1xuICAgIGlwYy5vbignZGVzZWxlY3QnLCBmdW5jdGlvbigpIHtcbiAgICAgIGJwID0gd2luZG93Wydicm93c2VyLXBsdXMnXTtcbiAgICAgIGJwLnNlbGVjdG9yLmhpZGUoKTtcbiAgICAgIGpRKGRvY3VtZW50KS5vZmYoJ21vdXNlbW92ZScsIGJwLm1vdXNlTW92ZSk7XG4gICAgICByZXR1cm4galEoZG9jdW1lbnQpLm9mZignY2xpY2snLCBicC5jbGljayk7XG4gICAgfSk7XG4gICAgaXBjLm9uKCdzZWxlY3Rpb24nLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjc3MsIGRpdiwgZG9jLCBodG1sLCBybiwgc2VsZWN0aW9uLCBzdHlsLCB0cmF2ZXJzZTtcbiAgICAgIGh0bWwgPSBudWxsO1xuICAgICAgY3NzID0gW107XG4gICAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICBpZiAoc2VsZWN0aW9uLnJhbmdlQ291bnQgPiAwKSB7XG4gICAgICAgIHJuID0gc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XG4gICAgICAgIGlmICghcm4pIHtcbiAgICAgICAgICByZXR1cm4gaXBjLnNlbmRUb0hvc3QoJ3ByZXZpZXcnLCB7XG4gICAgICAgICAgICB1cmw6IGxvY2F0aW9uLmhyZWZcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LmFwcGVuZENoaWxkKHJuLmNsb25lQ29udGVudHMoKSk7XG4gICAgICAgIGRvYyA9IGpRKHJuLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyKTtcbiAgICAgICAgc3R5bCA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGU7XG4gICAgICAgIGNzcy5wdXNoKHN0eWwoZG9jLCBudWxsKSk7XG4gICAgICAgIHRyYXZlcnNlID0gZnVuY3Rpb24oZGl2KSB7XG4gICAgICAgICAgdmFyIGRvY0VsZSwgZWxlLCBrZXksIHZhbCwgX2ksIF9sZW4sIF9yZWYsIF9yZWYxLCBfcmVzdWx0cztcbiAgICAgICAgICBfcmVmID0gZGl2LmNoaWxkcmVuO1xuICAgICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICBlbGUgPSBfcmVmW19pXTtcbiAgICAgICAgICAgIGRvY0VsZSA9IGRvYy5maW5kKGVsZS5ub2RlTmFtZSkuZmlsdGVyKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vdXRlckhUTUwgPT09IGVsZS5vdXRlckhUTUw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChkb2NFbGUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIF9yZWYxID0gc3R5bChkb2NFbGVbMF0sIG51bGwpO1xuICAgICAgICAgICAgICBmb3IgKGtleSBpbiBfcmVmMSkge1xuICAgICAgICAgICAgICAgIHZhbCA9IF9yZWYxW2tleV07XG4gICAgICAgICAgICAgICAgZWxlLnN0eWxlW2tleV0gPSB2YWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godHJhdmVyc2UoZWxlKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgICAgfTtcbiAgICAgICAgdHJhdmVyc2UoZGl2KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBpcGMuc2VuZFRvSG9zdCgnc2VsZWN0aW9uJywge1xuICAgICAgICBjc3M6IGNzcyxcbiAgICAgICAgaHRtbDogZGl2LmlubmVySFRNTFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlwYy5vbigndW5jbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgalEoJ2EnKS5jc3Moe1xuICAgICAgICAnY3Vyc29yJzogJ3RleHQnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBqUSgnYScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG4gIGlwYy5vbigndXBkSGlzdCcsIGZ1bmN0aW9uKGhpc3QpIHtcbiAgICB3aW5kb3cuaGlzdFRhZy5vcHRzLmhpc3QgPSBoaXN0O1xuICAgIHJldHVybiB3aW5kb3cuaGlzdFRhZy51cGRhdGUoKTtcbiAgfSk7XG4gIGlwYy5vbigndXBkRmF2JywgZnVuY3Rpb24oZmF2KSB7XG4gICAgd2luZG93LmZhdlRhZy5vcHRzLmZhdiA9IGZhdjtcbiAgICByZXR1cm4gd2luZG93LmZhdlRhZy51cGRhdGUoKTtcbiAgfSk7XG4gIGlwYy5vbignaGlzdG9yeVBhZ2UnLCBmdW5jdGlvbihoaXN0LCBmYXYpIHtcbiAgICB3aW5kb3cuZmF2VGFnID0gcmlvdC5tb3VudCgnZmF2Jywge1xuICAgICAgZmF2OiBmYXZcbiAgICB9KVswXTtcbiAgICByZXR1cm4gd2luZG93Lmhpc3RUYWcgPSByaW90Lm1vdW50KCdoaXN0Jywge1xuICAgICAgaGlzdDogaGlzdFxuICAgIH0pWzBdO1xuICB9KTtcbiAgaXBjLm9uKCdjbGVhckhpc3QnLCBmdW5jdGlvbigpIHtcbiAgICB3aW5kb3cuaGlzdFRhZy51bm1vdW50KGZhbHNlKTtcbiAgICByZXR1cm4gd2luZG93Lmhpc3RUYWcgPSByaW90Lm1vdW50KCdoaXN0JywgW10pO1xuICB9KTtcbn1cbiJdfQ==